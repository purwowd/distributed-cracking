{% extends "base.html" %}

{% block title %}Dashboard - Distributed Hashcat Cracking{% endblock %}

{% block content %}
<div class="py-4">
    <h1 class="mb-6 text-2xl font-bold text-gray-200 flex items-center"><i class="fa-solid fa-gauge-high mr-2 text-blue-400"></i> Dashboard</h1>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <!-- Task Stats -->
        <div>
            <div class="bg-gray-800 rounded-lg shadow-lg h-full overflow-hidden border border-gray-700">
                <div class="bg-blue-700 text-white px-4 py-3">
                    <h5 class="font-medium flex items-center"><i class="fa-solid fa-list-check mr-2"></i> Task Statistics</h5>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-5 text-center">
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ task_stats.total }}</h3>
                            <p class="text-gray-400 text-sm">Total</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ task_stats.pending }}</h3>
                            <p class="text-gray-400 text-sm">Pending</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ task_stats.running }}</h3>
                            <p class="text-gray-400 text-sm">Running</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ task_stats.completed }}</h3>
                            <p class="text-gray-400 text-sm">Completed</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ task_stats.failed }}</h3>
                            <p class="text-gray-400 text-sm">Failed</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <canvas id="taskChart" height="70"></canvas>
                    </div>
                </div>
                <div class="bg-gray-900 px-4 py-3 border-t border-gray-700 flex gap-2">
                    <a href="/tasks" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-all duration-200 shadow-md">View All Tasks</a>
                    <a href="/tasks/new" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-all duration-200 shadow-md">Create New Task</a>
                </div>
            </div>
        </div>
        
        <!-- Agent Stats -->
        <div>
            <div class="bg-gray-800 rounded-lg shadow-lg h-full overflow-hidden border border-gray-700">
                <div class="bg-green-700 text-white px-4 py-3">
                    <h5 class="font-medium flex items-center"><i class="fa-solid fa-desktop mr-2"></i> Agent Statistics</h5>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-4 text-center">
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ agent_stats.total }}</h3>
                            <p class="text-gray-400 text-sm">Total</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ agent_stats.online }}</h3>
                            <p class="text-gray-400 text-sm">Online</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ agent_stats.busy }}</h3>
                            <p class="text-gray-400 text-sm">Busy</p>
                        </div>
                        <div class="p-2">
                            <h3 class="text-xl font-bold text-gray-200">{{ agent_stats.offline }}</h3>
                            <p class="text-gray-400 text-sm">Offline</p>
                        </div>
                    </div>
                    <div class="mt-4">
                        <canvas id="agentChart" height="100"></canvas>
                    </div>
                </div>
                <div class="bg-gray-900 px-4 py-3 border-t border-gray-700">
                    <a href="/agents" class="px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700 transition-all duration-200 shadow-md">View All Agents</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Tasks -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
            <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
                <div class="bg-blue-700 text-white px-4 py-3">
                    <h5 class="font-medium flex items-center"><i class="fa-solid fa-clock-rotate-left mr-2"></i> Recent Tasks</h5>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-900">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Name</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Hash Type</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Progress</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700">
                            {% for task in recent_tasks %}
                            <tr class="hover:bg-gray-700">
                                <td class="px-4 py-3 whitespace-nowrap">
                                    <a href="/tasks/{{ task.id }}" class="text-blue-400 hover:text-blue-300 hover:underline font-medium">{{ task.name }}</a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-300">{{ task.hash_type }}</td>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    {% if task.status == "pending" %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-700 text-gray-300 border border-gray-600">Pending</span>
                                    {% elif task.status == "running" %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-900 text-blue-300 border border-blue-700">Running</span>
                                    {% elif task.status == "completed" %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300 border border-green-700">Completed</span>
                                    {% elif task.status == "failed" %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-900 text-red-300 border border-red-700">Failed</span>
                                    {% elif task.status == "cancelled" %}
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-yellow-900 text-yellow-300 border border-yellow-700">Cancelled</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    <div class="w-full bg-gray-700 rounded-full h-2 mb-1 relative border border-gray-600">
                                        {% if task.status == "running" %}
                                        <div class="bg-blue-600 h-2 rounded-full animate-pulse absolute top-0 left-0 progress-bar" data-width="{{ task.progress }}"></div>
                                        {% elif task.status == "completed" %}
                                        <div class="bg-green-600 h-2 rounded-full absolute top-0 left-0 w-full"></div>
                                        {% elif task.status == "failed" %}
                                        <div class="bg-red-600 h-2 rounded-full absolute top-0 left-0 progress-bar" data-width="{{ task.progress }}"></div>
                                        {% else %}
                                        <div class="bg-gray-500 h-2 rounded-full absolute top-0 left-0 progress-bar" data-width="{{ task.progress }}"></div>
                                        {% endif %}
                                    </div>
                                    <div class="text-xs text-gray-400">{{ task.progress }}%</div>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="px-4 py-6 text-center text-gray-400">
                                    <div class="bg-gray-900 text-blue-400 p-3 rounded-md inline-block border border-gray-700">
                                        No tasks found
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="bg-gray-900 px-4 py-3 border-t border-gray-700">
                    <a href="/tasks" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-all duration-200 shadow-md">View All Tasks</a>
                </div>
            </div>
        </div>
        
        <!-- Recent Results -->
        <div>
            <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
                <div class="bg-yellow-600 text-white px-4 py-3">
                    <h5 class="font-medium flex items-center"><i class="fa-solid fa-key mr-2"></i> Recent Results</h5>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-900">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Hash</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Plaintext</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Task</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Cracked At</th>
                            </tr>
                        </thead>
                        <tbody class="bg-gray-800 divide-y divide-gray-700">
                            {% for result in recent_results %}
                            <tr class="hover:bg-gray-700">
                                <td class="px-4 py-3 whitespace-nowrap text-sm font-mono text-gray-300">{{ result.hash_value[:10] }}...</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-300">{{ result.plaintext }}</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm">
                                    <a href="/tasks/{{ result.task_id }}" class="text-blue-400 hover:text-blue-300 hover:underline">View Task</a>
                                </td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-400">{{ result.cracked_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="px-4 py-6 text-center text-gray-400">
                                    <div class="bg-gray-900 text-yellow-400 p-3 rounded-md inline-block border border-gray-700">
                                        No results found
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="bg-gray-900 px-4 py-3 border-t border-gray-700">
                    <a href="/results" class="px-3 py-1 bg-yellow-600 text-white text-sm rounded hover:bg-yellow-700 transition-all duration-200 shadow-md">View All Results</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Charts -->
    <div class="mb-6">
        <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
            <div class="bg-blue-700 text-white px-4 py-3">
                <h5 class="font-medium flex items-center"><i class="fa-solid fa-chart-line mr-2"></i> System Performance</h5>
            </div>
            <div class="p-4 bg-gray-800" style="height: 350px; position: relative;">
                <canvas id="performanceChart" style="width: 100%; height: 100%; display: block;"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Store data in hidden div with data attributes to avoid JS linting issues with template syntax -->
<div id="chart-data" 
    data-task-pending="{{ task_stats.pending }}" 
    data-task-running="{{ task_stats.running }}" 
    data-task-completed="{{ task_stats.completed }}" 
    data-task-failed="{{ task_stats.failed }}" 
    data-task-cancelled="{{ task_stats.cancelled }}" 
    data-agent-online="{{ agent_stats.online }}" 
    data-agent-busy="{{ agent_stats.busy }}" 
    data-agent-offline="{{ agent_stats.offline }}" 
    class="hidden"></div>

<!-- Load dashboard charts JavaScript -->
<script src="/static/js/dashboard-charts.js"></script>
{% endblock %}
