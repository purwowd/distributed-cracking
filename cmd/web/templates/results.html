{% extends "base.html" %}

{% block title %}Results - Distributed Hashcat Cracking{% endblock %}

{% block content %}
<div class="py-4">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-200 flex items-center">
            <i class="fa-solid fa-key mr-2 text-blue-400"></i> Results
        </h1>
        {% if task_id %}
        <a href="/tasks/{{ task_id }}" class="px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-all duration-200 flex items-center shadow-md">
            <i class="fa-solid fa-arrow-left mr-2"></i> Back to Task
        </a>
        {% endif %}
    </div>
    
    <!-- Result Filters -->
    <div class="bg-gray-800 rounded-lg shadow-lg mb-6 overflow-hidden border border-gray-700">
        <div class="bg-gray-900 px-4 py-3 border-b border-gray-700">
            <h5 class="font-medium text-gray-200">Filters</h5>
        </div>
        <div class="p-4">
            <form id="filter-form" action="/results" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label for="task_id" class="block text-sm font-medium text-gray-300 mb-1">Task</label>
                    <input type="text" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                           id="task_id" name="task_id" value="{{ task_id or '' }}" placeholder="Filter by task ID">
                </div>
                <div>
                    <label for="hash_value" class="block text-sm font-medium text-gray-300 mb-1">Hash</label>
                    <input type="text" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                           id="hash_value" name="hash_value" value="{{ hash_value or '' }}" placeholder="Search by hash value">
                </div>
                <div>
                    <label for="plaintext" class="block text-sm font-medium text-gray-300 mb-1">Password</label>
                    <input type="text" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 text-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                           id="plaintext" name="plaintext" value="{{ plaintext or '' }}" placeholder="Search by password">
                </div>
                <div class="flex items-end gap-2">
                    <button type="submit" class="flex-grow px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 shadow-md">Apply Filters</button>
                    <button type="button" id="clear-filters" class="px-4 py-2 bg-gray-700 border border-gray-600 text-gray-300 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 shadow-md">Clear</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Results Table -->
    <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700">
        <div class="bg-gray-900 px-4 py-3 border-b border-gray-700">
            <div class="flex justify-between items-center">
                <h5 class="font-medium text-gray-200">Cracked Passwords</h5>
                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300 border border-green-700">{{ results|length }} Results</span>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-900">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Hash</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Password</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Task</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Agent</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Cracked At</th>
                    </tr>
                </thead>
                <tbody class="bg-gray-800 divide-y divide-gray-700">
                    {% for result in results %}
                    <tr class="hover:bg-gray-700">
                        <td class="px-6 py-4 whitespace-nowrap truncate max-w-[200px]" title="{{ result.hash_value }}" data-hash="{{ result.hash_value }}">
                            <div class="flex items-center">
                                <span class="text-sm text-gray-300 truncate">{{ result.hash_value }}</span>
                                <button class="ml-2 text-blue-400 hover:text-blue-300 focus:outline-none copy-hash" data-hash="{{ result.hash_value }}" title="Copy hash">
                                    <i class="fa-solid fa-clipboard"></i>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap" data-plaintext="{{ result.plaintext }}">
                            <div class="flex items-center">
                                <span class="text-sm text-gray-300">{{ result.plaintext }}</span>
                                <button class="ml-2 text-blue-400 hover:text-blue-300 focus:outline-none copy-plaintext" data-plaintext="{{ result.plaintext }}" title="Copy password">
                                    <i class="fa-solid fa-clipboard"></i>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <a href="/tasks/{{ result.task_id }}" class="text-blue-400 hover:text-blue-300 hover:underline">View Task</a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <a href="/agents/{{ result.agent_id }}" class="text-blue-400 hover:text-blue-300 hover:underline">View Agent</a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                            <div class="flex items-center">
                                <span>{{ result.cracked_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                                <button class="ml-2 text-blue-400 hover:text-blue-300 focus:outline-none copy-both" 
                                        data-hash="{{ result.hash_value }}" 
                                        data-plaintext="{{ result.plaintext }}" 
                                        title="Copy hash:password">
                                    <i class="fa-solid fa-clipboard-check"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-sm bg-gray-900 text-blue-400">No results found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
        <div class="px-4 py-3 bg-gray-900 border-t border-gray-700">
            {% if results %}
            <div class="flex justify-between items-center">
                <div>
                    <small class="text-sm text-gray-400">Showing {{ results|length }} results</small>
                </div>
                <div>
                    <button id="export-csv" class="px-3 py-1 bg-gray-700 border border-gray-600 rounded text-sm text-gray-300 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-all duration-200 shadow-md">
                        <i class="fa-solid fa-download mr-1"></i> Export CSV
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Hidden div with data attributes for JavaScript -->
<div id="results-data" class="hidden">
    {% for result in results %}
    <div class="result-item" 
         data-hash="{{ result.hash_value }}" 
         data-plaintext="{{ result.plaintext }}">
    </div>
    {% endfor %}
</div>

<!-- Toast container for notifications -->
<div id="toast-container" class="fixed bottom-0 right-0 p-3 z-50"></div>

<!-- Include external JavaScript file -->
<script src="/static/js/results.js"></script>
{% endblock %}
